{{ block content }}


<body>

<p>{{ form.age.label }}<br><br>
{{ form.age }}
    {{ formfield_errors 'age' }}</p>

<p>{{ form.gender.label }}
{{ form.gender }}
    {{ formfield_errors 'gender' }}</p>

<p>{{ form.education.label }}
{{ form.education }}
{{ formfield_errors 'education' }}
    <span id="education_message" style="color:#990000"></span></p>

<p>{{ form.income.label }}
{{ form.income }}
{{ formfield_errors 'income' }}
    <span id="income_message" style="color:#990000"></span></p>


</body>

<input type="hidden" name="ts_demo" id="ts_demo"/>

<button type="button" class="btn btn-primary" onclick="Validate()">Next</button>


<script>
//This bit creates 2 variables, one will function as a timer, the other will hold the timer output. They are set to 0 and -1 here to initialise them, these will not be the final outputs.
var pageTimeElapsed = 0;
var pageTimerID = -1;

//This function automatically starts the timer when the page loads. In this case I want seconds so the interval is set to 1000, but I believe if you set it to 1 then it will count milliseconds - you will need to test this
window.onload = function() {
  if(pageTimerID == -1){
    pageTimerID = setInterval(pageTick, 1000);
  }
};

//This function captures the timer output. When the timer starts it will increase 'pageTimeElapsed' every second and send this value to the 'timeSpent' variable that will be saved
//When a person moves to the next page, or the page times out, the final value that the timer was on will be saved. The value resets each round/page.
function pageTick() {
  pageTimeElapsed++
  document.getElementById("ts_demo").value = pageTimeElapsed;
}

    let optional_fields = js_vars.optional_fields;
    let times_submitted = 0;

    function Validate() {
        // let error_messages = []
        var items = []
        let isValid = []
        let messages = []

        times_submitted++

        if (times_submitted >= 2) {
                form.submit()
            } else {

            for (i = 0; i < optional_fields.length; i++) {
                isValid[i] = false
                messages[i] = "Please fill out this field"

                //Reference the Group of questions.
                // error_messages.push(optional_fields[i]);
                items.push(Array.from(document.getElementsByName(optional_fields[i])));

                // branches for radio (div) vs. text input (input, probably) items
                if (document.getElementById(optional_fields[i]).tagName == "DIV") {
                    //Loop and verify whether at-least one RadioButton is checked.
                    for (var j = 0; j < items[i].length; j++) {
                        if (items[i][j].checked) {
                            // if at least one radio is checked for the question, return true
                            isValid[i] = true;
                            messages[i] = "";
                            break;
                        } else {
                            scroll(0,0)
                        }
                    }
                } else {    // tests valid entry for non-div (i.e., text entry) items
                    if (document.getElementById(optional_fields[i]).value) {
                        isValid[i] = true;
                        messages[i] = "";
                    } else {
                        scroll(0,0)
                    }
                }
            }
        }
                // create summary items and flow after all the looping

        let all_checked = isValid.every(x => x);  //flags whether all questions are checked

        if (all_checked == true){        // branch submission or kicking participants to top of screen, depending on whether everything is checked and whether they have already tried submitting
            form.submit()
        } else {
            if (times_submitted >= 2) {
                form.submit()
            } else {
                scroll(0, 0)
            }


        }

        error_message.innerHTML = isValid
        education_message.innerHTML = messages[0]
        income_message.innerHTML = messages[1]
    }
</script>


{{ endblock }}
