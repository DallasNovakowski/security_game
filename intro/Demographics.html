{{ block content }}


<body>

<p>{{ form.age.label }}<br><br>
{{ form.age }}
    {{ formfield_errors 'age' }}</p>

<p>{{ form.gender.label }}
{{ form.gender }}
    {{ formfield_errors 'gender' }}</p>

<p>{{ form.education.label }}
{{ form.education }}
{{ formfield_errors 'education' }}
    <span id="education_message" style="color:#990000"></span></p>

<p>{{ form.income.label }}
{{ form.income }}
{{ formfield_errors 'income' }}
    <span id="income_message" style="color:#990000"></span></p>

<!--<span id="error_message"></span>-->

</body>


<button type="button" class="btn btn-primary" onclick="Validate()">Next</button>


<script>
<!--    document.getElementsByClassName('logo')[0].getElementsByTagName('img')[0].src ="/b.jpg";-->
    let optional_fields = js_vars.optional_fields;
    let times_submitted = 0;

    function Validate() {
        // let error_messages = []
        var items = []
        let isValid = []
        let messages = []

        times_submitted++

        if (times_submitted >= 2) {
                form.submit()
            } else {

            for (i = 0; i < optional_fields.length; i++) {
                isValid[i] = false
                messages[i] = "Please fill out this field"

                //Reference the Group of questions.
                // error_messages.push(optional_fields[i]);
                items.push(Array.from(document.getElementsByName(optional_fields[i])));

                // branches for radio (div) vs. text input (input, probably) items
                if (document.getElementById(optional_fields[i]).tagName == "DIV") {
                    //Loop and verify whether at-least one RadioButton is checked.
                    for (var j = 0; j < items[i].length; j++) {
                        if (items[i][j].checked) {
                            // if at least one radio is checked for the question, return true
                            isValid[i] = true;
                            messages[i] = "";
                            break;
                        } else {
                            scroll(0,0)
                        }
                    }
                } else {    // tests valid entry for non-div (i.e., text entry) items
                    if (document.getElementById(optional_fields[i]).value) {
                        isValid[i] = true;
                        messages[i] = "";
                    } else {
                        scroll(0,0)
                    }
                }
            }
        }
                // create summary items and flow after all the looping

        let all_checked = isValid.every(x => x);  //flags whether all questions are checked

        if (all_checked == true){        // branch submission or kicking participants to top of screen, depending on whether everything is checked and whether they have already tried submitting
            form.submit()
        } else {
            if (times_submitted >= 2) {
                form.submit()
            } else {
                scroll(0, 0)
            }


        }

        error_message.innerHTML = isValid
        education_message.innerHTML = messages[0]
        income_message.innerHTML = messages[1]
    }
</script>


{{ endblock }}
